name: Build and Deploy CCCC Frontendname: ðŸš€ Build and Deploy CCCC Frontendname: Deploy 11ty to GitHub Pages



on:on:

  push:

    branches: [ main ]on:  push:

    paths:

      - 'src/**'  # Trigger on push to main branch    branches: [ "main" ]

      - 'package*.json'

      - '.eleventy.js'  push:  workflow_dispatch:

      - '.github/workflows/**'

  workflow_dispatch:    branches: [ main ]



permissions:    paths:permissions:

  contents: read

  pages: write      - 'src/**'  contents: read

  id-token: write

      - 'package*.json'  pages: write

concurrency:

  group: "pages"      - '.eleventy.js'  id-token: write

  cancel-in-progress: false

      - '.github/workflows/**'

jobs:

  build:  concurrency:

    name: Build Frontend

    runs-on: ubuntu-latest  # Allow manual triggering  group: "pages"

    

    steps:  workflow_dispatch:  cancel-in-progress: true

      - name: Checkout repository

        uses: actions/checkout@v4

        with:

          fetch-depth: 0# Set permissions for GitHub Pages deploymentjobs:

        

      - name: Setup Node.jspermissions:  build:

        uses: actions/setup-node@v4

        with:  contents: read    runs-on: ubuntu-latest

          node-version: '20'

          cache: 'npm'  pages: write    steps:

          

      - name: Verify package.json  id-token: write      - uses: actions/checkout@v4

        run: |

          echo "Package.json contents:"      - uses: actions/setup-node@v4

          cat package.json

          echo "Available scripts:"# Allow only one concurrent deployment        with: { node-version: 20 }

          npm run

          concurrency:      - run: npm ci

      - name: Install dependencies

        run: |  group: "pages"      - run: npm run build

          echo "Installing dependencies..."

          npm ci --prefer-offline --no-audit  cancel-in-progress: false      - uses: actions/upload-pages-artifact@v3

          

      - name: Build site with Eleventy        with: { path: _site }   # <- Eleventyâ€™s output

        run: |

          echo "Building static site..."jobs:

          npm run build

          echo "Build completed!"  # Build job  deploy:

          

      - name: Build verification  build:    needs: build

        run: |

          echo "Checking build output:"    name: ðŸ”¨ Build Frontend    runs-on: ubuntu-latest

          ls -la public/

          echo "Built pages:"    runs-on: ubuntu-latest    environment:

          find public -name "*.html" | head -10

          echo "Search index:"          name: github-pages

          ls -la public/search.json || echo "Search index not found"

          echo "Assets:"    steps:      url: ${{ steps.deployment.outputs.page_url }}

          ls -la public/assets/ || echo "Assets folder not found"

                - name: ðŸ“¥ Checkout repository    steps:

      - name: Setup GitHub Pages

        uses: actions/configure-pages@v4        uses: actions/checkout@v4      - id: deployment

        

      - name: Upload Pages artifact        with:        uses: actions/deploy-pages@v4

        uses: actions/upload-pages-artifact@v3

        with:          fetch-depth: 0

          path: ./public        

      - name: ðŸ“¦ Setup Node.js

  deploy:        uses: actions/setup-node@v4

    name: Deploy to GitHub Pages        with:

    environment:          node-version: '20'

      name: github-pages          cache: 'npm'

      url: ${{ steps.deployment.outputs.page_url }}          

    runs-on: ubuntu-latest      - name: ðŸ” Verify package.json

    needs: build        run: |

              echo "ðŸ“‹ Package.json contents:"

    steps:          cat package.json

      - name: Deploy to GitHub Pages          echo "ðŸ”§ Available scripts:"

        id: deployment          npm run

        uses: actions/deploy-pages@v4          

              - name: ðŸ“š Install dependencies

      - name: Deployment complete        run: |

        run: |          echo "ðŸš€ Installing dependencies..."

          echo "Deployment successful!"          npm ci --prefer-offline --no-audit

          echo "Site URL: ${{ steps.deployment.outputs.page_url }}"          

          echo "Backend URL: https://62.169.21.243"      - name: ðŸ—ï¸ Build site with Eleventy

        run: |

  health-check:          echo "ðŸ”¨ Building static site..."

    name: Health Check          npm run build

    runs-on: ubuntu-latest          echo "âœ… Build completed!"

    needs: deploy          

    if: success()      - name: ðŸ“Š Build verification

            run: |

    steps:          echo "ðŸ“ Checking build output:"

      - name: Check site availability          ls -la public/

        run: |          echo "ðŸ“„ Built pages:"

          echo "Performing health check..."          find public -name "*.html" | head -10

          sleep 30          echo "ðŸ”— Search index:"

                    ls -la public/search.json || echo "âš ï¸ Search index not found"

          SITE_URL="https://uwaniumnya.github.io/Dyo-s-Dubious-Domain"          echo "ðŸ“¦ Assets:"

                    ls -la public/assets/ || echo "âš ï¸ Assets folder not found"

          echo "Testing site accessibility..."          

          if curl -f -s -o /dev/null "$SITE_URL"; then      - name: ðŸ”§ Setup GitHub Pages

            echo "Site is accessible at $SITE_URL"        uses: actions/configure-pages@v4

          else        

            echo "Site is not accessible"      - name: ðŸ“¤ Upload Pages artifact

            exit 1        uses: actions/upload-pages-artifact@v3

          fi        with:

                    path: ./public

          echo "Testing search.json..."          name: github-pages

          if curl -f -s -o /dev/null "$SITE_URL/search.json"; then

            echo "Search index is accessible"  # Deploy job

          else  deploy:

            echo "Search index not found"    name: ðŸš€ Deploy to GitHub Pages

          fi    environment:

                name: github-pages

      - name: Deployment summary      url: ${{ steps.deployment.outputs.page_url }}

        run: |    runs-on: ubuntu-latest

          echo "## Deployment Summary" >> $GITHUB_STEP_SUMMARY    needs: build

          echo "- **Frontend URL**: https://uwaniumnya.github.io/Dyo-s-Dubious-Domain" >> $GITHUB_STEP_SUMMARY    

          echo "- **Backend URL**: https://62.169.21.243" >> $GITHUB_STEP_SUMMARY    steps:

          echo "- **Build Time**: $(date)" >> $GITHUB_STEP_SUMMARY      - name: ðŸŒ Deploy to GitHub Pages

          echo "- **Status**: Successfully deployed" >> $GITHUB_STEP_SUMMARY        id: deployment
        uses: actions/deploy-pages@v4
        
      - name: âœ… Deployment complete
        run: |
          echo "ðŸŽ‰ Deployment successful!"
          echo "ðŸŒ Site URL: ${{ steps.deployment.outputs.page_url }}"
          echo "ðŸ”— Backend URL: https://62.169.21.243"
          
  # Optional: Health check job
  health-check:
    name: ðŸ¥ Health Check
    runs-on: ubuntu-latest
    needs: deploy
    if: success()
    
    steps:
      - name: ðŸ” Check site availability
        run: |
          echo "ðŸ¥ Performing health check..."
          sleep 30  # Wait for deployment to propagate
          
          SITE_URL="https://uwaniumnya.github.io/Dyo-s-Dubious-Domain"
          
          echo "ðŸ“¡ Testing site accessibility..."
          if curl -f -s -o /dev/null "$SITE_URL"; then
            echo "âœ… Site is accessible at $SITE_URL"
          else
            echo "âŒ Site is not accessible"
            exit 1
          fi
          
          echo "ðŸ” Testing search.json..."
          if curl -f -s -o /dev/null "$SITE_URL/search.json"; then
            echo "âœ… Search index is accessible"
          else
            echo "âš ï¸ Search index not found"
          fi
          
      - name: ðŸ“Š Deployment summary
        run: |
          echo "## ðŸŽ‰ Deployment Summary" >> $GITHUB_STEP_SUMMARY
          echo "- **Frontend URL**: https://uwaniumnya.github.io/Dyo-s-Dubious-Domain" >> $GITHUB_STEP_SUMMARY
          echo "- **Backend URL**: https://62.169.21.243" >> $GITHUB_STEP_SUMMARY
          echo "- **Build Time**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "- **Status**: âœ… Successfully deployed" >> $GITHUB_STEP_SUMMARY